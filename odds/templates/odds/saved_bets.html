{% extends 'base.html' %}

{% block title %}Saved Bets{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">My Saved Bets</h1>

    {% if games %}
        {% for game in games %}
            <div class="card mb-3">
                <div class="card-header bg-light">
                    <h4>
                        <a href="{% url 'odds:game_detail' game.id %}" style="text-decoration: none; color: inherit;">
                            {{ game.away_team }}
                            <span class="text-muted">@</span>
                            {{ game.home_team }}
                        </a>
                    </h4>
                    <h6 class="card-subtitle mb-2 text-muted">
                        {{ game.game_time|date:"D, M j, Y - g:i A" }}
                    </h6>
                </div>
                <div class="card-body">
                    <table class="table table-striped table-bordered">
                        <thead class="thead-dark">
                            <tr>
                                <th>Team</th>
                                <th>Moneyline</th>
                                <th>Spread</th>
                                <th>Spread Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>{{ game.away_team }}</strong></td>
                                <td>{{ game.away_team_moneyline }}</td>
                                <td>{{ game.away_team_spread }}</td>
                                <td>{{ game.away_team_spread_price }}</td>
                            </tr>
                            <tr>
                                <td><strong>{{ game.home_team }}</strong></td>
                                <td>{{ game.home_team_moneyline }}</td>
                                <td>{{ game.home_team_spread }}</td>
                                <td>{{ game.home_team_spread_price }}</td>
                            </tr>
                        </tbody>
                    </table>

                    <h5 class="mt-3">Total (Over/Under)</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <strong>Over:</strong> {{ game.total_over }}
                            <span class="text-muted">({{ game.total_over_price }})</span>
                        </li>
                        <li class="list-group-item">
                            <strong>Under:</strong> {{ game.total_under }}
                            <span class="text-muted">({{ game.total_under_price }})</span>
                        </li>
                    </ul>

                </div>
                <div class="card-footer text-muted d-flex justify-content-between align-items-center" style="font-size: 0.9rem;">
                    <div>
                        Odds from: <strong>{{ game.bookmaker_name }}</strong>
                        | Last Updated: {{ game.last_updated|date:"M j, g:i A" }}
                    </div>
                    <button 
                        class="btn btn-sm btn-warning save-bet-btn" 
                        data-game-id="{{ game.id }}"
                        style="background-color: #B3A369; border-color: #B3A369;">
                        <span class="save-text">Saved</span>
                    </button>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="alert alert-info" role="alert">
            You haven't saved any bets yet. 
            <br>
            <small>Visit the <a href="{% url 'odds:odds_list' %}">Odds page</a> to save your favorite bets!</small>
        </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const saveButtons = document.querySelectorAll('.save-bet-btn');
    
    saveButtons.forEach(button => {
        button.addEventListener('click', function() {
            const gameId = this.getAttribute('data-game-id');
            const span = this.querySelector('.save-text');
            const card = this.closest('.card');
            
            fetch(`/odds/${gameId}/save/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '{{ csrf_token }}'
                },
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (!data.saved) {
                    // If unsaved, remove the card from the page
                    card.style.transition = 'opacity 0.3s ease';
                    card.style.opacity = '0';
                    setTimeout(() => {
                        card.remove();
                        // Check if there are no more cards, show message
                        if (document.querySelectorAll('.card').length === 0) {
                            location.reload();
                        }
                    }, 300);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating saved bet.');
            });
        });
    });
});
</script>
{% endblock %}

